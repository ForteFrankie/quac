#!/usr/bin/env python

# Copyright (c) 2012-2013 Los Alamos National Security, LLC, and others.

# This script decompresses and cats the content of each .gz file in the given
# directory, prefixing each line with the timestamp embedded in the file's
# name.

import glob
import gzip
import io
import os
import subprocess
import sys

import quacpath
import time_
import wikimedia

os.chdir(sys.argv[1])

for fn in glob.glob('*.gz'):
   timestamp = time_.iso8601_date(wikimedia.timestamp_parse(fn))
   for line in gzip.open(fn, 'rb'):
      print timestamp, line,
